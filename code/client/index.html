<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HabitSphere</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar-container"></div>

  <!-- Page Content -->
  <div class="page-content">
    <div id="navbar-container"></div>

    <div class="main">
      <!-- Welcome -->
      <div class="welcome-user" style="margin-bottom: 20px; font-size: 20px; font-weight: 600;">
        Hey, <span id="username">User</span> ðŸ‘‹
      </div>

      <!-- AI Suggestion Box -->
      <div class="ai-suggestion">
        <strong>AI Suggestion</strong>
        <p>
          <span id="ai-message">Start something great today!</span><br>
          Motivation is what gets you started. Habit is what keeps you going.
        </p>
      </div>

      <!-- Todayâ€™s Habits -->
      <div class="section habits">
        <h2>Todayâ€™s Habits</h2>
        <div id="habitContainer" class="habit-cards">
          <!-- Habit cards will be dynamically injected -->
        </div>
      </div>

      <!-- Analytics Section (Optional dynamic) -->
      <div class="section analytics">
        <div class="stat-card half-width">
          <div class="flame">ðŸ”¥</div>
          <div class="text">
            <p>Streak</p>
            <h3 id="streak-count">7 days</h3>
          </div>
        </div>

        <div class="stat-card half-width">
          <div class="donut">
            <svg viewBox="0 0 36 36" class="circular-chart">
              <path class="circle-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path class="circle"
                stroke-dasharray="82, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <text x="18" y="20.35" class="percentage">82%</text>
            </svg>
            <p class="chart-label">Success vs Fail</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/renderComponents.js"></script>
  <script>
    // Load reusable components
    loadComponent("#sidebar-container", "components/sidebar.html");
    loadComponent("#navbar-container", "components/navbar.html");

    // Fetch user info
    fetch('/get_user_info')
      .then(res => res.json())
      .then(data => {
        if (data.fullname) {
          document.getElementById('username').textContent = data.fullname;
        }
      });

    // Fetch and render user habits
    fetch('/get_user_habits')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('habitContainer');
        container.innerHTML = "";

        if (data && data.length > 0) {
          data.forEach(habit => {
            const card = document.createElement("div");
            card.className = "habit-card";
            card.innerHTML = `
              <div class="card-body">
                <div class="icon">${habit.icon || 'ðŸ’¡'}</div>
                <div class="info">
                  <strong>${habit.habit}</strong>
                  <span>${habit.time || 'Anytime'}</span>
                </div>
              </div>
              <div class="actions">
                <button class="done">âœ” Done</button>
                <button class="skip">Skip</button>
              </div>
            `;

            // Button logic
            card.querySelector(".done").addEventListener("click", () => {
              updateHabitStatus(habit.habit, "Done");
              card.style.opacity = 0.5;
            });

            card.querySelector(".skip").addEventListener("click", () => {
              updateHabitStatus(habit.habit, "Skipped");
              card.style.opacity = 0.5;
            });

            container.appendChild(card);
          });
        } else {
          container.innerHTML = `<p style="text-align:center; color:#888;">No habits yet. Add some from "Create Habit".</p>`;
        }
      })
      .catch(err => {
        console.error('Error fetching user habits:', err);
      });

    // Update status
    function updateHabitStatus(habitName, status) {
      fetch('/update_habit_status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ habit: habitName, status: status })
      })
      .then(res => res.json())
      .then(data => {
        console.log("Status updated:", data);
      })
      .catch(err => {
        console.error("Status update error:", err);
      });
    }
  </script>
</body>
</html>
